var _e=Object.defineProperty,Ce=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var ee=(a,r,e)=>r in a?_e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[r]=e,ge=(a,r)=>{for(var e in r||(r={}))ke.call(r,e)&&ee(a,e,r[e]);if(le)for(var e of le(r))Ie.call(r,e)&&ee(a,e,r[e]);return a},de=(a,r)=>Ce(a,Oe(r));var R=(a,r,e)=>(ee(a,typeof r!="symbol"?r+"":r,e),e);import{c as At,l as _,r as V,R as P,B as Pt,T as Le,P as Fe,a as Ve,b as He,d as fe,e as Ut,f as Ge,D as ce,g as ue,h as be,i as me,j as ve,k as kt,G as re,S as Ne,U as ze,m as Je,n as Ue,o as qe,p as Ye,q as Ke}from"./vendor.035708b3.js";const Re=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const m of t.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function e(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerpolicy&&(t.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?t.credentials="include":n.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(n){if(n.ep)return;n.ep=!0;const t=e(n);fetch(n.href,t)}};Re();const tt={WHITE:"#EBE8E7",WHITISH:"#E2E0D8",WHITER:"#FFFEFD",BLACK:"#393538",HUES:["#68BAC8","#E35362","#E5CC5C"]},De=tt.HUES.map(a=>{let r=At(a).rgb(!1),e=At(tt.WHITE).rgb(!1);return At.rgb(Math.min(r[0]/e[0],1)*255,Math.min(r[1]/e[1],1)*255,Math.min(r[2]/e[2],1)*255).hex()});function ae(a){var r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(r,function(s,n,t,m){return n+n+t+t+m+m});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function Pe(a){var r=ae(a).r,e=ae(a).g,s=ae(a).b,n=["244 67 54","255 235 238","255 205 210","239 154 154","229 115 115","239 83 80","229 57 53","211 47 47","198 40 40","183 28 28","255 138 128","255 82 82","255 23 68","213 0 0","233 30 99","252 228 236","248 187 208","244 143 177","240 98 146","236 64 122","216 27 96","194 24 91","173 20 87","136 14 79","255 128 171","255 64 129","245 0 87","197 17 98","156 39 176","243 229 245","225 190 231","206 147 216","186 104 200","171 71 188","142 36 170","123 31 162","106 27 154","74 20 140","234 128 252","224 64 251","213 0 249","170 0 255","103 58 183","237 231 246","209 196 233","179 157 219","149 117 205","126 87 194","94 53 177","81 45 168","69 39 160","49 27 146","179 136 255","124 77 255","101 31 255","98 0 234","63 81 181","232 234 246","197 202 233","159 168 218","121 134 203","92 107 192","57 73 171","48 63 159","40 53 147","26 35 126","140 158 255","83 109 254","61 90 254","48 79 254","33 150 243","227 242 253","187 222 251","144 202 249","100 181 246","66 165 245","30 136 229","25 118 210","21 101 192","13 71 161","130 177 255","68 138 255","41 121 255","41 98 255","3 169 244","225 245 254","179 229 252","129 212 250","79 195 247","41 182 246","3 155 229","2 136 209","2 119 189","1 87 155","128 216 255","64 196 255","0 176 255","0 145 234","0 188 212","224 247 250","178 235 242","128 222 234","77 208 225","38 198 218","0 172 193","0 151 167","0 131 143","0 96 100","132 255 255","24 255 255","0 229 255","0 184 212","0 150 136","224 242 241","178 223 219","128 203 196","77 182 172","38 166 154","0 137 123","0 121 107","0 105 92","0 77 64","167 255 235","100 255 218","29 233 182","0 191 165","76 175 80","232 245 233","200 230 201","165 214 167","129 199 132","102 187 106","67 160 71","56 142 60","46 125 50","27 94 32","185 246 202","105 240 174","0 230 118","0 200 83","139 195 74","241 248 233","220 237 200","197 225 165","174 213 129","156 204 101","124 179 66","104 159 56","85 139 47","51 105 30","204 255 144","178 255 89","118 255 3","100 221 23","205 220 57","249 251 231","240 244 195","230 238 156","220 231 117","212 225 87","192 202 51","175 180 43","158 157 36","130 119 23","244 255 129","238 255 65","198 255 0","174 234 0","255 235 59","255 253 231","255 249 196","255 245 157","255 241 118","255 238 88","253 216 53","251 192 45","249 168 37","245 127 23","255 255 141","255 255 0","255 234 0","255 214 0","255 193 7","255 248 225","255 236 179","255 224 130","255 213 79","255 202 40","255 179 0","255 160 0","255 143 0","255 111 0","255 229 127","255 215 64","255 196 0","255 171 0","255 152 0","255 243 224","255 224 178","255 204 128","255 183 77","255 167 38","251 140 0","245 124 0","239 108 0","230 81 0","255 209 128","255 171 64","255 145 0","255 109 0","255 87 34","251 233 231","255 204 188","255 171 145","255 138 101","255 112 67","244 81 30","230 74 25","216 67 21","191 54 12","255 158 128","255 110 64","255 61 0","221 44 0","121 85 72","239 235 233","215 204 200","188 170 164","161 136 127","141 110 99","109 76 65","93 64 55","78 52 46","62 39 35","158 158 158","250 250 250","245 245 245","238 238 238","224 224 224","189 189 189","117 117 117","97 97 97","66 66 66","33 33 33","96 125 139","236 239 241","207 216 220","176 190 197","144 164 174","120 144 156","84 110 122","69 90 100","55 71 79","38 50 56","0 0 0","255 255 255"],t=["#f44336","#ffebee","#ffcdd2","#ef9a9a","#e57373","#ef5350","#e53935","#d32f2f","#c62828","#b71c1c","#ff8a80","#ff5252","#ff1744","#d50000","#e91e63","#fce4ec","#f8bbd0","#f48fb1","#f06292","#ec407a","#d81b60","#c2185b","#ad1457","#880e4f","#ff80ab","#ff4081","#f50057","#c51162","#9c27b0","#f3e5f5","#e1bee7","#ce93d8","#ba68c8","#ab47bc","#8e24aa","#7b1fa2","#6a1b9a","#4a148c","#ea80fc","#e040fb","#d500f9","#aa00ff","#673ab7","#ede7f6","#d1c4e9","#b39ddb","#9575cd","#7e57c2","#5e35b1","#512da8","#4527a0","#311b92","#b388ff","#7c4dff","#651fff","#6200ea","#3f51b5","#e8eaf6","#c5cae9","#9fa8da","#7986cb","#5c6bc0","#3949ab","#303f9f","#283593","#1a237e","#8c9eff","#536dfe","#3d5afe","#304ffe","#2196f3","#e3f2fd","#bbdefb","#90caf9","#64b5f6","#42a5f5","#1e88e5","#1976d2","#1565c0","#0d47a1","#82b1ff","#448aff","#2979ff","#2962ff","#03a9f4","#e1f5fe","#b3e5fc","#81d4fa","#4fc3f7","#29b6f6","#039be5","#0288d1","#0277bd","#01579b","#80d8ff","#40c4ff","#00b0ff","#0091ea","#00bcd4","#e0f7fa","#b2ebf2","#80deea","#4dd0e1","#26c6da","#00acc1","#0097a7","#00838f","#006064","#84ffff","#18ffff","#00e5ff","#00b8d4","#009688","#e0f2f1","#b2dfdb","#80cbc4","#4db6ac","#26a69a","#00897b","#00796b","#00695c","#004d40","#a7ffeb","#64ffda","#1de9b6","#00bfa5","#4caf50","#e8f5e9","#c8e6c9","#a5d6a7","#81c784","#66bb6a","#43a047","#388e3c","#2e7d32","#1b5e20","#b9f6ca","#69f0ae","#00e676","#00c853","#8bc34a","#f1f8e9","#dcedc8","#c5e1a5","#aed581","#9ccc65","#7cb342","#689f38","#558b2f","#33691e","#ccff90","#b2ff59","#76ff03","#64dd17","#cddc39","#f9fbe7","#f0f4c3","#e6ee9c","#dce775","#d4e157","#c0ca33","#afb42b","#9e9d24","#827717","#f4ff81","#eeff41","#c6ff00","#aeea00","#ffeb3b","#fffde7","#fff9c4","#fff59d","#fff176","#ffee58","#fdd835","#fbc02d","#f9a825","#f57f17","#ffff8d","#ffff00","#ffea00","#ffd600","#ffc107","#fff8e1","#ffecb3","#ffe082","#ffd54f","#ffca28","#ffb300","#ffa000","#ff8f00","#ff6f00","#ffe57f","#ffd740","#ffc400","#ffab00","#ff9800","#fff3e0","#ffe0b2","#ffcc80","#ffb74d","#ffa726","#fb8c00","#f57c00","#ef6c00","#e65100","#ffd180","#ffab40","#ff9100","#ff6d00","#ff5722","#fbe9e7","#ffccbc","#ffab91","#ff8a65","#ff7043","#f4511e","#e64a19","#d84315","#bf360c","#ff9e80","#ff6e40","#ff3d00","#dd2c00","#795548","#efebe9","#d7ccc8","#bcaaa4","#a1887f","#8d6e63","#6d4c41","#5d4037","#4e342e","#3e2723","#9e9e9e","#fafafa","#f5f5f5","#eeeeee","#e0e0e0","#bdbdbd","#757575","#616161","#424242","#212121","#607d8b","#eceff1","#cfd8dc","#b0bec5","#90a4ae","#78909c","#546e7a","#455a64","#37474f","#263238","#000000","#ffffff"],m=["rgb(244,67,54)","rgb(255,235,238)","rgb(255,205,210)","rgb(239,154,154)","rgb(229,115,115)","rgb(239,83,80)","rgb(229,57,53)","rgb(211,47,47)","rgb(198,40,40)","rgb(183,28,28)","rgb(255,138,128)","rgb(255,82,82)","rgb(255,23,68)","rgb(213,0,0)","rgb(233,30,99)","rgb(252,228,236)","rgb(248,187,208)","rgb(244,143,177)","rgb(240,98,146)","rgb(236,64,122)","rgb(216,27,96)","rgb(194,24,91)","rgb(173,20,87)","rgb(136,14,79)","rgb(255,128,171)","rgb(255,64,129)","rgb(245,0,87)","rgb(197,17,98)","rgb(156,39,176)","rgb(243,229,245)","rgb(225,190,231)","rgb(206,147,216)","rgb(186,104,200)","rgb(171,71,188)","rgb(142,36,170)","rgb(123,31,162)","rgb(106,27,154)","rgb(74,20,140)","rgb(234,128,252)","rgb(224,64,251)","rgb(213,0,249)","rgb(170,0,255)","rgb(103,58,183)","rgb(237,231,246)","rgb(209,196,233)","rgb(179,157,219)","rgb(149,117,205)","rgb(126,87,194)","rgb(94,53,177)","rgb(81,45,168)","rgb(69,39,160)","rgb(49,27,146)","rgb(179,136,255)","rgb(124,77,255)","rgb(101,31,255)","rgb(98,0,234)","rgb(63,81,181)","rgb(232,234,246)","rgb(197,202,233)","rgb(159,168,218)","rgb(121,134,203)","rgb(92,107,192)","rgb(57,73,171)","rgb(48,63,159)","rgb(40,53,147)","rgb(26,35,126)","rgb(140,158,255)","rgb(83,109,254)","rgb(61,90,254)","rgb(48,79,254)","rgb(33,150,243)","rgb(227,242,253)","rgb(187,222,251)","rgb(144,202,249)","rgb(100,181,246)","rgb(66,165,245)","rgb(30,136,229)","rgb(25,118,210)","rgb(21,101,192)","rgb(13,71,161)","rgb(130,177,255)","rgb(68,138,255)","rgb(41,121,255)","rgb(41,98,255)","rgb(3,169,244)","rgb(225,245,254)","rgb(179,229,252)","rgb(129,212,250)","rgb(79,195,247)","rgb(41,182,246)","rgb(3,155,229)","rgb(2,136,209)","rgb(2,119,189)","rgb(1,87,155)","rgb(128,216,255)","rgb(64,196,255)","rgb(0,176,255)","rgb(0,145,234)","rgb(0,188,212)","rgb(224,247,250)","rgb(178,235,242)","rgb(128,222,234)","rgb(77,208,225)","rgb(38,198,218)","rgb(0,172,193)","rgb(0,151,167)","rgb(0,131,143)","rgb(0,96,100)","rgb(132,255,255)","rgb(24,255,255)","rgb(0,229,255)","rgb(0,184,212)","rgb(0,150,136)","rgb(224,242,241)","rgb(178,223,219)","rgb(128,203,196)","rgb(77,182,172)","rgb(38,166,154)","rgb(0,137,123)","rgb(0,121,107)","rgb(0,105,92)","rgb(0,77,64)","rgb(167,255,235)","rgb(100,255,218)","rgb(29,233,182)","rgb(0,191,165)","rgb(76,175,80)","rgb(232,245,233)","rgb(200,230,201)","rgb(165,214,167)","rgb(129,199,132)","rgb(102,187,106)","rgb(67,160,71)","rgb(56,142,60)","rgb(46,125,50)","rgb(27,94,32)","rgb(185,246,202)","rgb(105,240,174)","rgb(0,230,118)","rgb(0,200,83)","rgb(139,195,74)","rgb(241,248,233)","rgb(220,237,200)","rgb(197,225,165)","rgb(174,213,129)","rgb(156,204,101)","rgb(124,179,66)","rgb(104,159,56)","rgb(85,139,47)","rgb(51,105,30)","rgb(204,255,144)","rgb(178,255,89)","rgb(118,255,3)","rgb(100,221,23)","rgb(205,220,57)","rgb(249,251,231)","rgb(240,244,195)","rgb(230,238,156)","rgb(220,231,117)","rgb(212,225,87)","rgb(192,202,51)","rgb(175,180,43)","rgb(158,157,36)","rgb(130,119,23)","rgb(244,255,129)","rgb(238,255,65)","rgb(198,255,0)","rgb(174,234,0)","rgb(255,235,59)","rgb(255,253,231)","rgb(255,249,196)","rgb(255,245,157)","rgb(255,241,118)","rgb(255,238,88)","rgb(253,216,53)","rgb(251,192,45)","rgb(249,168,37)","rgb(245,127,23)","rgb(255,255,141)","rgb(255,255,0)","rgb(255,234,0)","rgb(255,214,0)","rgb(255,193,7)","rgb(255,248,225)","rgb(255,236,179)","rgb(255,224,130)","rgb(255,213,79)","rgb(255,202,40)","rgb(255,179,0)","rgb(255,160,0)","rgb(255,143,0)","rgb(255,111,0)","rgb(255,229,127)","rgb(255,215,64)","rgb(255,196,0)","rgb(255,171,0)","rgb(255,152,0)","rgb(255,243,224)","rgb(255,224,178)","rgb(255,204,128)","rgb(255,183,77)","rgb(255,167,38)","rgb(251,140,0)","rgb(245,124,0)","rgb(239,108,0)","rgb(230,81,0)","rgb(255,209,128)","rgb(255,171,64)","rgb(255,145,0)","rgb(255,109,0)","rgb(255,87,34)","rgb(251,233,231)","rgb(255,204,188)","rgb(255,171,145)","rgb(255,138,101)","rgb(255,112,67)","rgb(244,81,30)","rgb(230,74,25)","rgb(216,67,21)","rgb(191,54,12)","rgb(255,158,128)","rgb(255,110,64)","rgb(255,61,0)","rgb(221,44,0)","rgb(121,85,72)","rgb(239,235,233)","rgb(215,204,200)","rgb(188,170,164)","rgb(161,136,127)","rgb(141,110,99)","rgb(109,76,65)","rgb(93,64,55)","rgb(78,52,46)","rgb(62,39,35)","rgb(158,158,158)","rgb(250,250,250)","rgb(245,245,245)","rgb(238,238,238)","rgb(224,224,224)","rgb(189,189,189)","rgb(117,117,117)","rgb(97,97,97)","rgb(66,66,66)","rgb(33,33,33)","rgb(96,125,139)","rgb(236,239,241)","rgb(207,216,220)","rgb(176,190,197)","rgb(144,164,174)","rgb(120,144,156)","rgb(84,110,122)","rgb(69,90,100)","rgb(55,71,79)","rgb(38,50,56)","rgb(0,0,0)","rgb(255,255,255)"],f=[],l="#F44336,#E91E63,#673AB7,#3F51B5,#FFEB3B,#FF5722".toLowerCase().split(",");for(let p=0;p<n.length;p++){var i=/^(.*)\s(.*)\s(.*)$/.exec(n[p]),h=Number(i[1]),g=Number(i[2]),u=Number(i[3]);f[p]=Math.abs(h-r)+Math.abs(g-e)+Math.abs(u-s),l.indexOf(t[p].toLowerCase())<0&&(f[p]=255*3)}let c=Math.min.apply(Math,f),M=f.indexOf(c),y=t[M],A=m[M];return y.replace("#",""),(y+"ff").replace("#",""),A.replace("rgb(","").replace(")",""),(A.replace("rgb(","rgba(").replace(")","")+",1)").replace("rgba(","").replace(")",""),t[M]}function $e(a){return parseInt(Pe((a||0).toString(16).padStart(6,"0")).substring(1),16)}function Me(a){return(Math.floor(a.r)*256+Math.floor(a.g))*256+Math.floor(a.b)}function ct(a){return{r:Math.floor(a/256/256)%256,g:Math.floor(a/256)%256,b:Math.floor(a)%256}}class st{constructor(r,e,s){R(this,"bodyParts",8);R(this,"maxWheels",4);R(this,"wheelProb",.5);R(this,"maxLength",10);R(this,"maxRadius",5);R(this,"minRadius",1);R(this,"minAngleWeight",.32);R(this,"maxAngleWeight",6.4);R(this,"score",0);R(this,"data",{lengths:[],angleWeights:[],wheels:[],colors:[]});R(this,"importCar",function(r){var e=new st;try{var s=r;r.split(",").length<3?s=Xe(r):s=r.split(",");for(var n={lengths:[],angleWeights:[],wheels:[],colors:[]},t=0;t<8;t++)n.lengths.push(this.maxLength*parseFloat(s[t*2+1])/3),n.angleWeights.push(parseFloat(s[t*2]));for(var m=parseInt(s[s.length-1]),t=0;t<m;t++)n.wheels.push({index:parseInt(s[16+t*3]),r:this.maxRadius*parseFloat(s[16+t*3+2])/1.5,o:parseInt(s[16+t*3])>-1,axelAngle:parseFloat(s[16+t*3+1])});for(var t=0;t<16;t++)n.colors.push(parseInt(s[40+t]));e=new st(n)}catch(f){return console.log("E",f),e}return e.materialize(),e});this.maxWheels;var n=this.wheelProb;if(s&&(n=s),r)this.data=r;else{this.data={lengths:[],angleWeights:[],wheels:[],colors:[]};for(var t=0;t<this.bodyParts;t++)this.data.lengths.push(this.maxLength*(Math.random()/4*3+.25)),this.data.angleWeights.push(.5+Math.random());for(var t=0;t<this.bodyParts*2;t++)this.data.colors.push((Math.floor(Math.random()*256)*256+Math.floor(Math.random()*256))*256+Math.floor(Math.random()*256));for(var t=0;t<2;t++)this.data.wheels.push({index:Math.floor(Math.random()*this.bodyParts),r:(this.maxRadius-this.minRadius)*Math.random()+this.minRadius,o:!0,axelAngle:t/this.bodyParts*Math.PI*2});for(var t=0;t<this.wheelMax-2;t++)this.data.wheels.push({index:Math.floor(Math.random()*this.bodyParts),r:(this.maxRadius-this.minRadius)*Math.random()+this.minRadius,o:Math.random()<n,axelAngle:t/this.bodyParts*Math.PI*2})}this.materialize()}fixAngleWeights(){for(var r=0,e=0;e<this.bodyParts;e++)r+=this.data.angleWeights[e];for(var e=0;e<this.bodyParts;e++)this.data.angleWeights[e]=Math.min(Math.max(this.data.angleWeights[e]/r*this.bodyParts,this.minAngleWeight),this.maxAngleWeight)}materialize(){for(var r=0;r<this.data.colors.length;r++)this.data.colors[r]=$e(this.data.colors[r])}totalAngleWeights(){for(var r=0,e=0;e<this.bodyParts;e++)r+=this.data.angleWeights[e];return r}compareWheels(r,e){return 0}wheelsAt(r){for(var e=[],s=0;s<this.data.wheels.length;s++)this.data.wheels[s].index==r&&e.push(this.data.wheels[s]);return e.sort(this.compareWheels),e}sectionSimiliarity(r,e,s){return this.data.lengths[e]/this.maxLength,this.data.angleWeights[e]/this.totalAngleWeights(),this.wheelsAt(e),r.data.lengths[s]/r.maxLength,r.data.angleWeights[s]/r.totalAngleWeights(),r.wheelsAt(s),0}bestMap(r){for(var e=0;e<this.bodyParts;e++);}getAreaOfPiece(r){r=(r%this.bodyParts+this.bodyParts)%this.bodyParts;for(var e=0,s=0;s<this.bodyParts;s++)e+=this.data.angleWeights[s];var n=Math.PI*2*this.data.angleWeights[(r+1)%this.bodyParts]/e,t=Math.sin(n)*this.data.lengths[r]*this.data.lengths[(r+1)%this.bodyParts]/2;return t}exportCar(){for(var r=[],e=0,s=0,n=0;n<this.bodyParts;n++)s+=this.data.angleWeights[n];for(var n=0;n<this.bodyParts;n++)r.push(this.data.angleWeights[n]),r.push(this.data.lengths[n]/this.maxLength*3),e+=Math.PI*2*this.data.angleWeights[n]/s;for(var t=0,n=0;n<this.data.wheels.length;n++)this.data.wheels[n].o&&(r.push(this.data.wheels[n].index),r.push(this.data.wheels[n].axelAngle),r.push(this.data.wheels[n].r/this.maxRadius*1.5),t++);for(var n=0;n<this.bodyParts-t;n++)r.push("NaN"),r.push(.1),r.push(.1);for(var n=0;n<this.bodyParts*2;n++)r.push(this.data.colors[n]);r.push(t);for(var n=0;n<r.length;n++);return r.join(",")}breed(r,e,s){var n=Math.max(1,this.score)/(Math.max(1,this.score)+Math.max(1,r.score));n=Math.sign(n-.5)*(.5+.25*Math.random())+.5;var t=Math.random();this.maxWheels;var m=this.wheelProb,m=this.wheelProb;s&&(m=s);var f=.001,l=.025;this.fixAngleWeights(),r.fixAngleWeights(),this.data.wheels.sort(this.compareWheels),r.data.wheels.sort(this.compareWheels);var i=new st;i.score=this.score*n+r.score*(1-n);for(var h=0;h<this.bodyParts;h++)if(Math.random()>l){var g=(Math.random()-.5)/.99+.5;g=.5+(g-.5)*(1-t)+(n-.5)*t,i.data.lengths[h]=Math.min(Math.max((this.data.lengths[h]*g+r.data.lengths[h]*(1-g))*(1-f)+f*Math.random()*this.maxLength,0),this.maxLength),i.data.angleWeights[h]=Math.max((this.data.angleWeights[h]/this.totalAngleWeights()*g+r.data.angleWeights[h]/r.totalAngleWeights()*(1-g))*(1-f)+f*(Math.random()*(this.maxAngleWeight-this.minAngleWeight)+this.minAngleWeight),0)}for(var h=0;h<this.bodyParts*2;h++)if(Math.random()>l){var g=(Math.random()-.5)/.99+.5;g=.5+(g-.5)*(1-t)+(n-.5)*t;var u=ct(this.data.colors[h]),c=ct(r.data.colors[h]),M=ct(0);M.r=Math.min(Math.max((u.r*g+c.r*(1-g))*(1-f)+f*Math.random()*256,0),255),M.g=Math.min(Math.max((u.g*g+c.g*(1-g))*(1-f)+f*Math.random()*256,0),255),M.b=Math.min(Math.max((u.b*g+c.b*(1-g))*(1-f)+f*Math.random()*256,0),255),i.data.colors[h]=Me(M)}i.data.wheels=[];for(var h=0;h<Math.min(Math.max(this.data.wheels.length,r.data.wheels.length),this.maxWheels);h++){var y=h<this.data.wheels.length,A=h<r.data.wheels.length,b=y?this.data.wheels[h]:r.data.wheels[h],B=y&&A?r.data.wheels[h]:b,g=(Math.random()-.5)/.99+.5;g=.5+(g-.5)*(1-t)+(n-.5)*t,b.o&&b.r,B.o&&B.r;var p=Math.min(Math.max((b.r*g+B.r*(1-g))*(1-f)+f*Math.random()*this.maxRadius,this.minRadius),this.maxRadius),g=(Math.random()-.5)/.99+.5;g=.5+(g-.5)*(1-t)+(n-.5)*t;var E=((b.o?1:0)*g+(B.o?1:0)*(1-g))*(1-f)+f*Math.random()>.5,w={x:Math.cos(b.index*Math.PI*2/this.bodyParts),y:Math.sin(b.index*Math.PI*2/this.bodyParts)},H={x:Math.cos(B.index*Math.PI*2/this.bodyParts),y:Math.sin(B.index*Math.PI*2/this.bodyParts)},g=(Math.random()-.5)/.99+.5;g=.5+(g-.5)*(1-t)+(n-.5)*t;var W={x:w.x*g+H.x*(1-g),y:w.y*g+H.y*(1-g)},S=Math.floor(Math.atan2(W.y,W.x)/Math.PI/2*this.bodyParts+.05),L=Math.floor(Math.random()*this.bodyParts),w={x:Math.cos(L*Math.PI*2/this.bodyParts),y:Math.sin(L*Math.PI*2/this.bodyParts)},H={x:Math.cos(S*Math.PI*2/this.bodyParts),y:Math.sin(S*Math.PI*2/this.bodyParts)};g=f,W={x:w.x*g+H.x*(1-g),y:w.y*g+H.y*(1-g)},S=(Math.floor(Math.atan2(W.y,W.x)/Math.PI/2*this.bodyParts+.05)%this.bodyParts+this.bodyParts)%this.bodyParts,Math.random()<l&&(S=Math.floor(Math.random()*this.bodyParts)),p<=this.minRadius&&(E=!1),Math.random()<l&&(E=Math.random()>.1,p=(this.maxRadius-this.minRadius)*Math.random()+this.minRadius);var J={index:S,r:p,o:E,axelAngle:S/this.bodyParts*Math.PI*2};i.data.wheels.push(J)}var q=e-i.data.wheels.length;if(q>0)for(var G=0;G<q;G++){var O=Math.floor(Math.random()*this.bodyParts);i.data.wheels.push({index:O+0,r:(this.maxRadius-this.minRadius)*Math.random()+this.minRadius,o:Math.random()<m,axelAngle:O/this.bodyParts*Math.PI*2})}if(q<0)for(var G=0;G<-q;G++)i.data.wheels.splice(Math.floor(Math.random()*i.data.wheels.length),1);for(var et=0,h=0;h<i.data.wheels.length;h++)i.data.wheels[h].o&&et++;var ot=i.data.wheels.length*m-et;if(ot>0)for(var G=0;G<ot;G++){var it=Math.floor(Math.random()*i.data.wheels.length);i.data.wheels[it].o=Math.random()<.5||i.data.wheels[it].o}if(Math.random()<l)if(i.data.wheels.length<this.maxWheels&&Math.random()<.5){var O=Math.floor(Math.random()*this.bodyParts);i.data.wheels.push({index:O,r:(this.maxRadius-this.minRadius)*Math.random()+this.minRadius,o:Math.random()<.1,axelAngle:O/this.bodyParts*Math.PI*2})}else i.data.wheels.splice(Math.floor(Math.random()*i.data.wheels.length),1);return i.materialize(),i.fixAngleWeights(),i}breed2(r,e,s){var n=Math.max(1,this.score)/(Math.max(1,this.score)+Math.max(1,r.score)),t=2;this.maxWheels;var m=this.wheelProb,m=this.wheelProb;s&&(m=s);var f=.05;this.fixAngleWeights(),r.fixAngleWeights(),this.data.wheels.sort(this.compareWheels),r.data.wheels.sort(this.compareWheels);var l=new st;l.score=this.score*n+r.score*(1-n);for(var i=0;i<this.bodyParts;i++)if(Math.random()>f){var h=(Math.random()-.5)/.99+.5;h=.5+(h-.5)*(1-t)+(n-.5)*t;var g=g>Math.random()?1:0;l.data.lengths[i]=Math.min(Math.max((this.data.lengths[i]*h+r.data.lengths[i]*(1-h))*(1-g)+g*Math.random()*this.maxLength,0),this.maxLength);var g=g>Math.random()?1:0;l.data.angleWeights[i]=Math.max((this.data.angleWeights[i]/this.totalAngleWeights()*h+r.data.angleWeights[i]/r.totalAngleWeights()*(1-h))*(1-g)+g*Math.random()*1/this.bodyParts,0)}for(var i=0;i<this.bodyParts*2;i++)if(Math.random()>f){var h=(Math.random()-.5)/.99+.5;h=.5+(h-.5)*(1-t)+(n-.5)*t;var u=ct(this.data.colors[i]),c=ct(r.data.colors[i]),M=ct(0),g=g>Math.random()?1:0;M.r=Math.min(Math.max((u.r*h+c.r*(1-h))*(1-g)+g*Math.random()*256,0),255);var g=g>Math.random()?1:0;M.g=Math.min(Math.max((u.g*h+c.g*(1-h))*(1-g)+g*Math.random()*256,0),255);var g=g>Math.random()?1:0;M.b=Math.min(Math.max((u.b*h+c.b*(1-h))*(1-g)+g*Math.random()*256,0),255),l.data.colors[i]=Me(M)}l.data.wheels=[];for(var i=0;i<Math.min(Math.max(this.data.wheels.length,r.data.wheels.length),this.maxWheels);i++){var y=i<this.data.wheels.length,A=i<r.data.wheels.length,b=y?this.data.wheels[i]:r.data.wheels[i],B=y&&A?r.data.wheels[i]:b,h=(Math.random()-.5)/.99+.5;h=.5+(h-.5)*(1-t)+(n-.5)*t,b.o&&b.r,B.o&&B.r;var g=g>Math.random()?1:0,p=Math.min(Math.max((b.r*h+B.r*(1-h))*(1-g)+g*Math.random()*this.maxRadius,this.minRadius),this.maxRadius),h=(Math.random()-.5)/.99+.5;h=.5+(h-.5)*(1-t)+(n-.5)*t;var g=g>Math.random()?1:0,E=((b.o?1:0)*h+(B.o?1:0)*(1-h))*(1-g)+g*Math.random()>.5,w={x:Math.cos(b.index*Math.PI*2/this.bodyParts),y:Math.sin(b.index*Math.PI*2/this.bodyParts)},H={x:Math.cos(B.index*Math.PI*2/this.bodyParts),y:Math.sin(B.index*Math.PI*2/this.bodyParts)},h=(Math.random()-.5)/.99+.5;h=.5+(h-.5)*(1-t)+(n-.5)*t;var W={x:w.x*h+H.x*(1-h),y:w.y*h+H.y*(1-h)},S=Math.floor(Math.atan2(W.y,W.x)/Math.PI/2*this.bodyParts),L=Math.floor(Math.random()*this.bodyParts),w={x:Math.cos(L*Math.PI*2/this.bodyParts),y:Math.sin(L*Math.PI*2/this.bodyParts)},H={x:Math.cos(S*Math.PI*2/this.bodyParts),y:Math.sin(S*Math.PI*2/this.bodyParts)};h=g,W={x:w.x*h+H.x*(1-h),y:w.y*h+H.y*(1-h)};var g=g>Math.random()?1:0;S=(Math.floor(Math.atan2(W.y,W.x)/Math.PI/2*this.bodyParts)+this.bodyParts+this.bodyParts)%this.bodyParts,Math.random()<f&&(S=Math.floor(Math.random()*this.bodyParts)),p<=this.minRadius&&(E=!1),Math.random()<f&&(E=Math.random()>.1,p=(this.maxRadius-this.minRadius)*Math.random()+this.minRadius);var J={index:S,r:p,o:E,axelAngle:S/this.bodyParts*Math.PI*2};l.data.wheels.push(J)}var q=e-l.data.wheels.length;if(q>0)for(var G=0;G<q;G++){var O=Math.floor(Math.random()*this.bodyParts);l.data.wheels.push({index:O+0,r:(this.maxRadius-this.minRadius)*Math.random()+this.minRadius,o:Math.random()<m,axelAngle:O/this.bodyParts*Math.PI*2})}if(q<0)for(var G=0;G<-q;G++)l.data.wheels.splice(Math.floor(Math.random()*l.data.wheels.length),1);for(var et=0,i=0;i<l.data.wheels.length;i++)l.data.wheels[i].o&&et++;var ot=l.data.wheels.length*m-et;if(ot>0)for(var G=0;G<ot;G++){var it=Math.floor(Math.random()*l.data.wheels.length);l.data.wheels[it].o=Math.random()<.5||l.data.wheels[it].o}if(Math.random()<f)if(l.data.wheels.length<this.maxWheels&&Math.random()<.5){var O=Math.floor(Math.random()*this.bodyParts);l.data.wheels.push({index:O,r:(this.maxRadius-this.minRadius)*Math.random()+this.minRadius,o:Math.random()<.1,axelAngle:O/this.bodyParts*Math.PI*2})}else l.data.wheels.splice(Math.floor(Math.random()*l.data.wheels.length),1);return l.materialize(),l.fixAngleWeights(),l}clone(){this.data.wheels.sort(this.compareWheels);for(var r=new st,e=0;e<this.bodyParts;e++)r.data.lengths[e]=this.data.lengths[e]+0,r.data.angleWeights[e]=this.data.angleWeights[e]+0;r.data.wheels=[];for(var e=0;e<this.data.wheels.length;e++){var s=this.data.wheels[e],n={index:s.index+0,r:s.r+0,o:s.o&&!0,axelAngle:s.axelAngle+0};r.data.wheels.push(n)}return r.materialize(),r}}function Xe(a){for(var r=Ze(a),e=new JXG.Util.Unzip(JXG.Util.Base64.decodeAsArray(a)).unzip()[0][0],s=[],n=0;n<16;n++)s.push(r.getFloat64(n*8));for(var n=0;n<8;n++){var t=r.getInt32(n*8*2.5+128);Math.abs(t)<10||(t=NaN),s.push(t),s.push(r.getFloat64(n*8*2.5+16*8+.5*8)),Math.abs(s[s.length-1])<Math.pow(2,-100)&&(s[s.length-1]=0),s.push(r.getFloat64(n*8*2.5+16*8+1.5*8)),Math.abs(s[s.length-1])<Math.pow(2,-100)&&(s[s.length-1]=0)}for(var m=(r.getUint8(44*8+3)%8+7)%8+1,n=0;n<16;n++){var f=n*4+288;f<e.length-1&&s.push(r.getUint32(f))}return s.push(m),s}function Ze(a){for(var r=new JXG.Util.Unzip(JXG.Util.Base64.decodeAsArray(a)).unzip()[0][0],e=new ArrayBuffer(r.length),s=new DataView(e),n=0;n<r.length;n++)s.setUint8(n,r.charCodeAt(n),!1);return s}class X{constructor(r,e,s){R(this,"x");R(this,"y");R(this,"z");this.x=r,this.y=e,this.z=s}dot2(r,e){return this.x*r+this.y*e}dot3(r,e,s){return this.x*r+this.y*e+this.z*s}}var Qe=[new X(1,1,0),new X(-1,1,0),new X(1,-1,0),new X(-1,-1,0),new X(1,0,1),new X(-1,0,1),new X(1,0,-1),new X(-1,0,-1),new X(0,1,1),new X(0,-1,1),new X(0,1,-1),new X(0,-1,-1)],pe=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],C=new Array(512),z=new Array(512);const we=function(a){a>0&&a<1&&(a*=65536),a=Math.floor(a),a<256&&(a|=a<<8);for(var r=0;r<256;r++){var e;r&1?e=pe[r]^a&255:e=pe[r]^a>>8&255,C[r]=C[r+256]=e,z[r]=z[r+256]=Qe[e%12]}};we(0);var je=.5*(Math.sqrt(3)-1),It=(3-Math.sqrt(3))/6,tr=1/3,at=1/6;const er=function(a,r){var e,s,n,t=(a+r)*je,m=Math.floor(a+t),f=Math.floor(r+t),l=(m+f)*It,i=a-m+l,h=r-f+l,g,u;i>h?(g=1,u=0):(g=0,u=1);var c=i-g+It,M=h-u+It,y=i-1+2*It,A=h-1+2*It;m&=255,f&=255;var b=z[m+C[f]],B=z[m+g+C[f+u]],p=z[m+1+C[f+1]],E=.5-i*i-h*h;E<0?e=0:(E*=E,e=E*E*b.dot2(i,h));var W=.5-c*c-M*M;W<0?s=0:(W*=W,s=W*W*B.dot2(c,M));var S=.5-y*y-A*A;return S<0?n=0:(S*=S,n=S*S*p.dot2(y,A)),70*(e+s+n)},rr=function(a,r,e){var s,n,t,m,f=(a+r+e)*tr,l=Math.floor(a+f),i=Math.floor(r+f),h=Math.floor(e+f),g=(l+i+h)*at,u=a-l+g,c=r-i+g,M=e-h+g,y,A,b,B,p,E;u>=c?c>=M?(y=1,A=0,b=0,B=1,p=1,E=0):u>=M?(y=1,A=0,b=0,B=1,p=0,E=1):(y=0,A=0,b=1,B=1,p=0,E=1):c<M?(y=0,A=0,b=1,B=0,p=1,E=1):u<M?(y=0,A=1,b=0,B=0,p=1,E=1):(y=0,A=1,b=0,B=1,p=1,E=0);var W=u-y+at,S=c-A+at,L=M-b+at,w=u-B+2*at,H=c-p+2*at,J=M-E+2*at,q=u-1+3*at,G=c-1+3*at,O=M-1+3*at;l&=255,i&=255,h&=255;var et=z[l+C[i+C[h]]],ot=z[l+y+C[i+A+C[h+b]]],it=z[l+B+C[i+p+C[h+E]]],Ft=z[l+1+C[i+1+C[h+1]]],ft=.6-u*u-c*c-M*M;ft<0?s=0:(ft*=ft,s=ft*ft*et.dot3(u,c,M));var bt=.6-W*W-S*S-L*L;bt<0?n=0:(bt*=bt,n=bt*bt*ot.dot3(W,S,L));var ht=.6-w*w-H*H-J*J;ht<0?t=0:(ht*=ht,t=ht*ht*it.dot3(w,H,J));var Z=.6-q*q-G*G-O*O;return Z<0?m=0:(Z*=Z,m=Z*Z*Ft.dot3(q,G,O)),32*(s+n+t+m)};function Lt(a){return a*a*a*(a*(a*6-15)+10)}function nt(a,r,e){return(1-e)*a+e*r}const ar=function(a,r){var e=Math.floor(a),s=Math.floor(r);a=a-e,r=r-s,e=e&255,s=s&255;var n=z[e+C[s]].dot2(a,r),t=z[e+C[s+1]].dot2(a,r-1),m=z[e+1+C[s]].dot2(a-1,r),f=z[e+1+C[s+1]].dot2(a-1,r-1),l=Lt(a);return nt(nt(n,m,l),nt(t,f,l),Lt(r))},nr=function(a,r,e){var s=Math.floor(a),n=Math.floor(r),t=Math.floor(e);a=a-s,r=r-n,e=e-t,s=s&255,n=n&255,t=t&255;var m=z[s+C[n+C[t]]].dot3(a,r,e),f=z[s+C[n+C[t+1]]].dot3(a,r,e-1),l=z[s+C[n+1+C[t]]].dot3(a,r-1,e),i=z[s+C[n+1+C[t+1]]].dot3(a,r-1,e-1),h=z[s+1+C[n+C[t]]].dot3(a-1,r,e),g=z[s+1+C[n+C[t+1]]].dot3(a-1,r,e-1),u=z[s+1+C[n+1+C[t]]].dot3(a-1,r-1,e),c=z[s+1+C[n+1+C[t+1]]].dot3(a-1,r-1,e-1),M=Lt(a),y=Lt(r),A=Lt(e);return nt(nt(nt(m,h,M),nt(f,g,M),A),nt(nt(l,u,M),nt(i,c,M),A),y)},Wt={seed:we,simplex2:er,simplex3:rr,perlin2:ar,perlin3:nr};var N=25,dt=(a=>(a[a.Sisyphus=0]="Sisyphus",a[a.Hills=1]="Hills",a[a.Crescendo=2]="Crescendo",a[a.Rocky=3]="Rocky",a))(dt||{});function sr(a){return a<N?0:Wt.perlin2((a-N)/20,0)*10+Wt.perlin2((a-N)/10,(a-N)/10)*10-Math.pow(Math.max(a-N,0)/10,1.2)/4*10}function or(a){return a<N?0:Wt.perlin2((a-N)/15,0)*(12-2/((a-N+10)/7))+Wt.perlin2((a-N)/7,(a-N)/7)}function ir(a){if(a<N)return 0;var r=250-25;return r-Math.sqrt(1-Math.pow(Math.max(a-N,0)/r,2))*r?(r-Math.sqrt(1-Math.pow(Math.max(a-N,0)/r,2))*r)*1.75:Wt.perlin2((a-N)/15,0)*(12-2/((a-N+10)/7))+Wt.perlin2((a-N)/7,(a-N)/7)}function hr(a){if(a<N)return 0;var r=1;return a<N+100&&(r=Math.max(a-N,0)/100),-Math.sin(Math.max(a-N,0)/20+Math.pow(Math.max(a-N,0)/20,1.75)/20)*10*r}const ne=2,Kt=4,lr=65535,gr=65535^ne^Kt,Ee=65535^Kt^ne,Bt={};Bt.filterCategoryBits=Kt;Bt.filterMaskBits=Ee;Bt.density=.5;Bt.friction=10;Bt.restitution=.1;const ut={};ut.filterCategoryBits=ne;ut.filterMaskBits=lr;ut.density=2;ut.friction=10;ut.restitution=.05;const dr=de(ge({},ut),{density:-ut.density}),wt={};wt.filterCategoryBits=Kt;wt.filterMaskBits=Ee;wt.density=15;wt.friction=10;wt.restitution=.05;const Rt={};Rt.filterMaskBits=gr;Rt.density=2;Rt.restitution=.05;const fr={density:0,friction:2},cr=10,ur=1.5;var ye=6*Math.PI;const br=(a,{terrainXSRef:r,cameraRef:e,world:s,ground:n,carScoreRef:t,restartCurrentRef:m,distTicksRef:f,currentTicksRef:l,boxCarRef:i,scaleRef:h,genXRef:g,terrain:u,setLeaderboard:c,setScore:M,restartTicksRef:y,handleImportCarRef:A,removeOldCarRef:b,GRAVITY:B})=>{let p=1;function E(o){t.current<o-3&&(m.current=0,t.current=o+0,i.current.score=o+0,f.current=l.current+0)}var W=[];r.current=[];function S(){for(;n.m_fixtureList;)n.destroyFixture(n.m_fixtureList);r.current=[],W=[]}function L(){for(;g.current<e.current.x+Math.max(a.width/h.current/2,100);){var o=.5,d=g.current,x=g.current+(u===dt.Hills||u===dt.Sisyphus?2:7);g.current=x;var v=u===dt.Hills?hr:u===dt.Sisyphus?ir:u===dt.Crescendo?sr:or,T=_.Vec2(d,v(d)),I=_.Vec2(x,v(x)),Y=Math.atan2(I.y-T.y,I.x-T.x);let rt=_.Vec2(I.y-T.y,T.x-I.x);rt.normalize();var K=_.Box(Math.sqrt(Math.pow(I.x-T.x,2)+Math.pow(I.y-T.y,2))/2,o,_.Vec2(T.x/2+I.x/2,T.y/2+I.y/2).add(rt.mul(o/2)),Y),k=n.createFixture(K,fr);W.push(k),r.current.push(I),k.render={special:"ground",fill:tt.BLACK,stroke:tt.BLACK,layer:0}}}L();var w=[],H=[],J=[],q=6,G=16,O=new st;function et(){for(var o=[],d=0;d<w.length;d++)o.push(w[w.length-d-1].car);for(var d=0;d<H.length;d++)o.push(H[H.length-d-1].car);for(var d=0;d<J.length;d++)o.push(J[J.length-d-1].car);var x=2;return o[Math.floor(Math.pow(Math.random(),x)*o.length)].breed(o[Math.floor(Math.pow(Math.random(),x)*o.length)])}function ot(){if(w.length<1)return 0;for(var o=w[0].score,d=0;d<w.length;d++)o=Math.min(o,w[d].score);return o}function it(o,d,x){w.push({score:d,ticks:x,car:o}),w.sort(function(v,T){return v.score-T.score}),w.length>q&&w.splice(0,w.length-q)}function Ft(){w.sort(function(o,d){return d.score-o.score}),c(w),w.length>0&&document.querySelectorAll("#score-best")[0].setAttribute("value",w[0].car.exportCar())}function ft(o){t.current=Math.max(i.current.getPosition().x,t.current);var d=t.current+0,x=f.current+0;o?(w=[],H=[],J=[],O=new st,Nt(O)):(d>0&&(J.push({score:d,ticks:f.current,car:O.clone()}),it(O.clone(),d,x)),J.length>=G&&(J.sort(function(v,T){return v.score-T.score}),J.splice(0,J.length-4),H=J,J=[]),H.length===0?(w.length>0?O=et():O=new st,Nt(O)):(O=et(),Nt(O))),Ft()}function bt(o){t.current+0,w=[],H=[],J=[],O=new st().importCar(o),Nt(O)}A.current=bt;var ht,Z,mt=_.Vec2(0,10);i.current=s.createDynamicBody({position:mt.clone()});var se=Bt;se.friction=1;var Dt=!1,Et=[],U=[],St=[],Vt=[],vt=[],Ht=[],Q=[],Mt=[],j=[],lt=[],$t=[],$=[],Tt=[],_t=[],pt=[],yt=[],Xt=mt.clone();function oe(){for(var o=0;o<U.length;o++)s.destroyBody(U[o].m_body);for(var o=0;o<vt.length;o++)s.destroyBody(vt[o].m_body);for(var o=0;o<Q.length;o++)Q[o]&&s.destroyBody(Q[o]);for(var o=0;o<yt.length;o++)yt[o]&&s.destroyBody(yt[o]);for(var o=0;o<lt.length;o++)lt[o]&&s.destroyBody(lt[o]);for(var o=0;o<pt.length;o++)pt[o]&&s.destroyBody(pt[o]);s.destroyBody(i.current),i.current=s.createBody({position:mt.clone()}),Et=[],U=[],St=[],Vt=[],vt=[],Ht=[],Q=[],Mt=[],j=[],Tt=[],yt=[],lt=[],$=[],_t=[],pt=[],Xt=mt.clone()}b.current=oe;var F=1;let Gt=De;function Nt(o){m.current=0,O=o,oe(),i.current=s.createDynamicBody({position:mt.clone()}),U=[],St=[],Vt=[],vt=[],Ht=[],Q=[],Mt=[],j=[],Tt=[],yt=[],lt=[],$=[],_t=[],pt=[],Xt=mt.clone();var d=mt.y+0,x=Math.abs(o.data.angleWeights[0]/o.totalAngleWeights()*Math.PI*2%(Math.PI*2));(x+Math.PI)%(Math.PI*2)-Math.PI<0&&(x=Math.PI-1-((x+Math.PI)%(Math.PI*2)-Math.PI));for(var v=0;v<o.bodyParts;v++){Vt.push(o.getAreaOfPiece(v));var T=x+o.data.angleWeights[(v+1)%o.data.angleWeights.length]/o.totalAngleWeights()*Math.PI*2,I=_.Polygon([_.Vec2(0,0),_.Vec2(Math.cos(x+0)*o.data.lengths[v]*F,Math.sin(x+0)*o.data.lengths[v]*F),_.Vec2(Math.cos(T+0)*o.data.lengths[(v+1)%o.data.lengths.length]*F,Math.sin(T+0)*o.data.lengths[(v+1)%o.data.lengths.length]*F)]),Y=ut;(((T-x+0)/Math.PI*180+360)%360+360)%360>180&&(Y=dr,console.log("neg"));var K=i.current.createFixture(I,Y);d=Math.min(d,K.getAABB(0).lowerBound.y),ct(parseInt(Pe((o.data.colors[v]||0).toString(16).padStart(6,"0")).substring(1),16));let Te=o.data.colors[v]||0;var k=Gt[Te%Gt.length];K.render={fill:k,stroke:k,layer:6},U.push(K),St.push(v),Ht.push(I);for(var rt=o.wheelsAt(v),zt=[],xt=[],Ct=0;Ct<rt.length;Ct++){var D=rt[Ct];if(D.o){ct(o.data.colors[(o.data.wheels.indexOf(D)+8)%o.data.colors.length]);var Jt=_.Vec2(Math.cos(x)*o.data.lengths[v]*F,Math.sin(x)*o.data.lengths[v]*F).add(Xt).sub(_.Vec2(Math.cos(D.axelAngle)*o.maxRadius*F/3,Math.sin(D.axelAngle)*o.maxRadius*F/3)),Zt=_.Vec2(Math.cos(D.axelAngle)*.2*F*o.maxRadius/3,Math.sin(D.axelAngle)*.2*F*o.maxRadius/3).add(Jt),Qt=s.createDynamicBody(Zt),jt=Qt.createFixture(_.Box(.2*F*o.maxRadius/1.5,.05*F*o.maxRadius/1.5,_.Vec2(0,0),D.axelAngle),wt),Se=K.getBody().createFixture(_.Box(.2*F*o.maxRadius/1.5,.1*F*o.maxRadius/1.5,_.Vec2(Math.cos(x)*o.data.lengths[v]*F,Math.sin(x)*o.data.lengths[v]*F),D.axelAngle),wt),Ot=s.createDynamicBody(Jt),te=Ot.createFixture(_.Circle(D.r*F*.89),se);te.render={fill:tt.BLACK,layer:7};let gt=o.data.colors[(o.data.wheels.indexOf(D)+8)%o.data.colors.length]||0;var k=Gt[gt%Gt.length];Se.render={fill:k,stroke:k,layer:9},jt.render={fill:k,stroke:k,layer:8};var ie=s.createJoint(_.PrismaticJoint({enableMotor:!0,lowerTranslation:-o.maxRadius*F/3,upperTranslation:o.maxRadius*F/3*.075,enableLimit:!0},K.getBody(),Qt,Ot.getWorldCenter(),_.Vec2(-Math.cos(D.axelAngle)/1,-Math.sin(D.axelAngle)/1))),he=s.createJoint(_.RevoluteJoint({motorSpeed:-ye,maxMotorTorque:42/2,enableMotor:!0},jt.getBody(),Ot,Ot.getWorldCenter()));j.push(he),zt.push(he),Q.push(Ot),Mt.push(te),$.push(ie),xt.push(ie),lt.push(Qt),$t.push(jt),d=Math.min(d,te.getAABB(0).lowerBound.y),K.getBody().resetMassData()}}Tt.push([zt]),_t.push([xt]),x=T}d=d-.5,i.current.resetMassData(),i.current.setPosition(_.Vec2(i.current.getPosition().x,i.current.getPosition().y-d));for(var v=0;v<$t.length;v++){let gt=$t[v].m_body;gt.setPosition(_.Vec2(gt.getPosition().x,gt.getPosition().y-d))}for(var v=0;v<Mt.length;v++){let gt=Mt[v].m_body;gt.setPosition(_.Vec2(gt.getPosition().x,gt.getPosition().y-d))}t.current=0,e.current.x=0,m.current=0,f.current=0,l.current=0,g.current=-200,S(),L(),Ft()}ft(!0),s.on("post-solve",function(o,d){for(var x=o;x;){for(var v=0;v<U.length;v++){var T=U[v],I=50*U[v].m_body.m_mass/2;if(x.getFixtureA()==T&&vt.indexOf(x.getFixtureB())<0&&Mt.indexOf(x.getFixtureB())<0||x.getFixtureB()==T&&vt.indexOf(x.getFixtureA())<0&&Mt.indexOf(x.getFixtureA())<0){for(var Y=!1,K=0;K<x.v_points.length;K++)x.v_points[K].normalImpulse>I&&(Y=!0);Y&&Et.push(T)}}x=x.m_next}});function Ae(o){if(U.indexOf(o)>=0){U.indexOf(o);var d=Ht.splice(U.indexOf(o),1)[0];Vt.splice(U.indexOf(o),1)[0];var x=St.splice(U.indexOf(o),1)[0],v=Tt.splice(U.indexOf(o),1)[0],T=_t.splice(U.indexOf(o),1)[0];U.splice(U.indexOf(o),1);var I=i.current.m_fixtureList;if(!(I==null?void 0:I.m_shape)||!(I==null?void 0:I.getBody()))return;U.indexOf(I);var Y=I.getBody(),K=Y.getWorldCenter();if(v[1])for(var k=0;k<v[1].length;k++)pt.push(lt.splice(lt.indexOf(T[1][k].m_bodyB),1)[0]),yt.push(Q.splice(Q.indexOf(v[1][k].m_bodyB),1)[0]),s.destroyJoint(v[1][k]),s.destroyJoint(T[1][k]);var rt=St.indexOf((x+O.bodyParts-1)%O.bodyParts);if(rt>=0&&doubleWheelParent){Tt[rt][1]=v[0],_t[rt][1]=T[0];for(var k=0;k<T[0].length;k++)T[0][k].m_bodyA=U[rt].m_body}else for(var k=0;k<v[0].length;k++)yt.push(Q.splice(Q.indexOf(v[0][k].m_bodyB),1)[0]),s.destroyJoint(v[0][k]),pt.push(Q.splice(lt.indexOf(T[0][k].m_bodyB),1)[0]),s.destroyJoint(T[0][k]);var zt=o.render;i.current.destroyFixture(o),o=null;var xt=s.createBody({type:"dynamic",position:Y.getPosition(),angle:Y.getAngle()});o=xt.createFixture(d,Rt),o.render=zt,o.render.layer=2,vt.push(o);var Ct=Y.getWorldCenter(),D=xt.getWorldCenter(),Jt=_.Vec2.add(ht,_.Vec2.cross(Z,_.Vec2.sub(Ct,K))),Zt=_.Vec2.add(ht,_.Vec2.cross(Z,_.Vec2.sub(D,K)));Y.setAngularVelocity(Z),Y.setLinearVelocity(Jt),xt.setAngularVelocity(Z),xt.setLinearVelocity(Zt),i.current.resetMassData()}}function We(){L();var o=i.current.m_mass;try{for(var d=0;d<j.length;d++)j[d].m_bodyB&&j[d].m_bodyB.m_mass&&(o+=j[d].m_bodyB.m_mass),$[d].m_bodyB&&(o+=$[d].m_bodyB.m_mass)}catch{}o=o/F/F;for(var x=ur*B/j.length*o,v=7.5*o/6,d=0;d<j.length;d++)j[d].m_bodyB&&j[d].setMaxMotorTorque(x*2),$[d].setMotorSpeed(ye),$[d].enableMotor(!0),$[d].m_bodyB&&($[d].setMaxMotorForce(v+40/40*v*Math.pow(5*$[d].getJointTranslation()/F/(O.maxRadius*F/3),2)),$[d].setMotorSpeed(-20/20*5*$[d].getJointTranslation()/F/(O.maxRadius*F/3)));m.current++,l.current++;var T=i.current.getPosition();if(e.current.x=T.x,e.current.y=-T.y,E(T.x),(m.current>=y.current||U.length<3)&&ft(),Et.length>0){for(var I=0;I<Et.length;I++)Ae(Et[I]);Et=[]}ht=i.current.getLinearVelocity(),Z=i.current.getAngularVelocity()}function Be(){for(var o=0;o<p;o++){let x={af:!0,simSpeed:100};Dt!==x.af&&(p=10),Dt=x.af,Dt?t.current>ot()?p=10:p=100:p=x.simSpeed,M(Math.max(i.current.getPosition().x,t.current)),s.step(1/75);var d=new Date().getTime();We(),new Date().getTime()-d}}return()=>{Be()}},qt=()=>{var a;return(a=window.devicePixelRatio)!=null?a:1},mr=(a,{cameraRef:r,scaleRef:e,world:s,terrainXSRef:n})=>{var t=a.getContext("2d");a.width=window.innerWidth*qt(),a.height=window.innerHeight*qt();function m(l,i){t.lineCap="round",t.save(),new Path2D().arc(l.m_p.x*e.current,l.m_p.y*e.current,l.m_radius*e.current,0,2*Math.PI),t.beginPath(),t.shadowBlur=0,t.shadowColor="rgba(0,0,0,0)",t.shadowOffsetY=0,t.shadowOffsetX=0,t.strokeStyle=tt.BLACK,t.lineWidth=e.current/4,t.globalCompositeOperation,t.strokeStyle=tt.BLACK,t.fillStyle=tt.WHITER,t.arc(l.m_p.x*e.current,l.m_p.y*e.current,l.m_radius*e.current,0,2*Math.PI),t.beginPath(),t.arc(l.m_p.x*e.current,l.m_p.y*e.current,l.m_radius*e.current,0,2*Math.PI),t.stroke(),t.beginPath(),t.strokeStyle=tt.BLACK,t.lineWidth=e.current/4,t.moveTo(l.m_p.x*e.current,l.m_p.y*e.current),t.lineTo(l.m_p.x*e.current+l.m_radius*e.current,l.m_p.y*e.current),t.stroke(),t.globalCompositeOperation="orig",t.restore()}function f(l,i,h){var y,A;t.save();let g=new Path2D;g.moveTo(l.m_vertices[0].x*e.current,l.m_vertices[0].y*e.current);for(var u=1;u<l.m_vertices.length;u++)g.lineTo(l.m_vertices[u].x*e.current,l.m_vertices[u].y*e.current);t.lineJoin="round",t.lineCap="round",t.beginPath();let c=t.globalCompositeOperation;if(h){t.globalCompositeOperation="source-over",t.strokeStyle="#8B9B56",t.fillStyle=At("#8B9B56").brighten(1).hex(),t.moveTo(l.m_vertices[1].x*e.current,l.m_vertices[1].y*e.current),t.lineTo(l.m_vertices[2].x*e.current,l.m_vertices[2].y*e.current);let b=t.getTransform().transformPoint(new DOMPoint(l.m_vertices[1].x*e.current,l.m_vertices[1].y*e.current)),B=t.getTransform().transformPoint(new DOMPoint(l.m_vertices[2].x*e.current,l.m_vertices[2].y*e.current)),p=t.getTransform().inverse().transformPoint(new DOMPoint(B.x,a.height));t.lineTo(p.x,p.y);let E=t.getTransform().inverse().transformPoint(new DOMPoint(b.x,a.height));t.lineTo(E.x,E.y),t.save(),t.clip(),t.moveTo(l.m_vertices[1].x*e.current,l.m_vertices[1].y*e.current),t.lineTo(l.m_vertices[2].x*e.current,l.m_vertices[2].y*e.current),t.lineTo(p.x,p.y),t.lineTo(E.x,E.y),t.fill(),t.beginPath(),t.lineWidth=e.current/2,t.moveTo(l.m_vertices[1].x*e.current,l.m_vertices[1].y*e.current),t.lineTo(l.m_vertices[2].x*e.current,l.m_vertices[2].y*e.current),t.stroke(),t.restore()}else{t.moveTo(l.m_vertices[0].x*e.current,l.m_vertices[0].y*e.current);for(var u=1;u<l.m_vertices.length;u++)t.lineTo(l.m_vertices[u].x*e.current,l.m_vertices[u].y*e.current)}t.shadowBlur=0,t.shadowColor="rgba(0,0,0,0)",t.shadowOffsetY=0,t.shadowOffsetX=0,t.fillStyle=At((A=(y=i.render)==null?void 0:y.stroke)!=null?A:t.strokeStyle).brighten(2);let M=t.strokeStyle+"";if(t.strokeStyle=t.fillStyle,t.lineWidth=8,t.closePath(),!h){if(t.fill(),t.globalCompositeOperation="multiply",t.lineWidth=1e-4,t.stroke(),t.strokeStyle=M,l.m_vertices.length===3&&!1)for(var u;u<3;u++);else t.stroke();if(t.lineWidth=e.current/4,l.m_vertices.length===3&&!1)for(var u;u<3;u++);else t.stroke()}t.globalCompositeOperation=c,t.restore()}return()=>{var B;let l=Math.ceil(window.innerWidth*qt()),i=Math.ceil(window.innerHeight*qt());(a.width!==l||a.height!==i)&&(a.width=l,a.height=i),e.current=Math.min(a.width/40,a.height/40),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,a.width,a.height),t.fillStyle=tt.WHITE,t.fillRect(0,0,a.width,a.height),t.translate(-r.current.x*e.current,-r.current.y*e.current),t.globalAlpha=1,t.globalCompositeOperation="multiply",t.globalCompositeOperation="source-over",t.globalAlpha=1,t.translate(r.current.x*e.current,r.current.y*e.current),t.translate(a.width/2,a.height/2),t.scale(1,-1),t.translate(-r.current.x*e.current,r.current.y*e.current);var h=[];function g(p,E,W){for(var S=!1,L=0;L<h.length;L++)h[L].index==p&&(S=!0,h[L].pairs.push({f:E,b:W}));S||h.push({index:p,pairs:[{f:E,b:W}]})}for(var u=s.getBodyList();u;u=u.getNext())for(var c=u.getFixtureList();c;c=c.getNext()){var M=0;c.render&&c.render.layer&&(M=c.render.layer),g(M,c,u)}h.sort(function(p,E){return p.index-E.index});let y=n.current;if(y.length>=2){t.beginPath();let p=t.getTransform().transformPoint(new DOMPoint(y[0].x*e.current,y[0].y*e.current)),E=t.getTransform().transformPoint(new DOMPoint(y[y.length-1].x*e.current,y[y.length-1].y*e.current)),W=t.getTransform().inverse().transformPoint(new DOMPoint(E.x,a.height)),S=t.getTransform().inverse().transformPoint(new DOMPoint(p.x,a.height));t.moveTo(S.x,S.y);for(let L=0;L<y.length;L++){let w=y[L];t.lineTo(w.x*e.current,w.y*e.current)}t.lineTo(W.x,W.y),t.globalCompositeOperation="source-over",t.strokeStyle="#8B9B56",t.fillStyle=At("#8B9B56").brighten(1).hex(),t.lineWidth=e.current*(.5-.5*.5),t.fill(),t.stroke()}for(var A=0;A<h.length;A++)for(var b=0;b<h[A].pairs.length;b++){var c=h[A].pairs[b].f,u=h[A].pairs[b].b;if(t.strokeStyle=c.render&&c.render.stroke?c.render.stroke:"#000000",t.fillStyle=c.render&&c.render.fill?c.render.fill:"rgba(0,0,0,0)",t.lineWidth=1,t.save(),t.globalCompositeOperation="multiply",t.translate(c.m_body.m_xf.p.x*e.current,c.m_body.m_xf.p.y*e.current),t.rotate(Math.atan2(c.m_body.m_xf.q.s,c.m_body.m_xf.q.c)),c.m_shape.getType()=="polygon"){let W=((B=c.render)==null?void 0:B.special)==="ground";W||f(c.m_shape,c,W)}c.m_shape.getType()=="circle"&&m(c.m_shape),t.restore(),t.globalCompositeOperation="source-over",t.globalAlpha=1}}},vr=({setScore:a,setLeaderboard:r,handleImportCarRef:e,terrain:s})=>{const[n,t]=V.exports.useState(null),m=V.exports.useRef(_.Vec2(0,0)),[f,l]=V.exports.useState(cr),i=V.exports.useMemo(()=>_.World({gravity:_.Vec2(0,-f)}),[f]),h=V.exports.useRef([]),g=V.exports.useMemo(()=>i.createBody(),[i]),u=V.exports.useRef(-200),c=V.exports.useRef(Math.min(window.innerWidth/40,window.innerHeight/40)),M=V.exports.useRef(null),y=V.exports.useRef(0),A=V.exports.useRef(0),b=V.exports.useRef(400),B=V.exports.useRef(0),p=V.exports.useRef(0),E=V.exports.useRef(()=>{});return V.exports.useEffect(()=>{if(n){const W={cameraRef:m,world:i,ground:g,setScore:a,setLeaderboard:r,terrain:s,genXRef:u,GRAVITY:f,currentTicksRef:y,distTicksRef:A,restartTicksRef:b,restartCurrentRef:B,carScoreRef:p,boxCarRef:M,scaleRef:c,terrainXSRef:h,handleImportCarRef:e,removeOldCarRef:E};console.log("REGO");const S=setInterval(br(n,W),1e3/75),L=setInterval(mr(n,W),1e3/75);return()=>{clearInterval(L),clearInterval(S),E.current()}}},[n,s]),P.createElement("canvas",{ref:W=>t(W)})};function xe(a,r=100){let e;return(...s)=>{e||(a.apply(this,s),e=setTimeout(()=>{e=void 0},r))}}const Yt=[dt.Rocky,dt.Hills,dt.Sisyphus],Mr=()=>{const[a,r]=V.exports.useState(0),[e,s]=V.exports.useState([]),n=V.exports.useRef(b=>{}),[t,m]=V.exports.useState(Yt[Math.floor(Math.random()*3)]),[f,l]=V.exports.useState(!1),[i,h]=V.exports.useState(""),[g,u]=V.exports.useState(""),[c,M]=V.exports.useState(!1),y=()=>{M(!1)},A=()=>{l(!1)};return P.createElement(Pt,null,P.createElement(vr,{handleImportCarRef:n,setScore:xe(b=>r(b)),setLeaderboard:xe(b=>s(b)),terrain:t}),P.createElement(Pt,{sx:{top:0,position:"absolute",padding:1}},P.createElement(Le,{component:Fe,elevation:0,sx:{bgcolor:tt.WHITISH}},P.createElement(Ve,{sx:{minWidth:104},"aria-label":"simple table"},P.createElement(He,null,P.createElement(fe,null,P.createElement(Ut,{align:"right"},"Score"),P.createElement(Ut,{align:"right"},"Time"))),P.createElement(Ge,null,e.map((b,B)=>P.createElement(fe,{key:b.score+"_"+b.ticks,sx:{"&:last-child td, &:last-child th":{border:0}}},P.createElement(Ut,{align:"right"},b.score.toFixed(2)),P.createElement(Ut,{align:"right"},(b.ticks/75).toFixed(2)))))))),P.createElement(Pt,{sx:{bottom:0,position:"absolute",width:1,padding:1,boxSizing:"border-box"}},P.createElement(ce,{onClose:A,open:f},P.createElement(ue,null,"Import Car"),P.createElement(be,null,P.createElement(me,{label:"Car Data",variant:"outlined",value:i,onChange:b=>h(b.target.value)})),P.createElement(ve,null,P.createElement(kt,{onClick:()=>{A(),n.current(i)}},"Import"))),P.createElement(ce,{onClose:y,open:c},P.createElement(ue,null,"Export Car"),P.createElement(be,null,P.createElement(me,{label:"Copyable Car Data",variant:"outlined",value:g})),P.createElement(ve,null,P.createElement(kt,{onClick:y},"Done"))),P.createElement(re,{container:!0,sx:{width:1},gap:1},P.createElement(re,{item:!0,container:!0,flex:"1",alignItems:"end"},P.createElement(Pt,{sx:{typography:"h4",color:"primary"}},"Score: ",a.toFixed(2))),P.createElement(re,{item:!0,flex:"1"},P.createElement(Ne,{gap:1,alignItems:"end"},P.createElement(kt,{disableElevation:!0,size:"large",onClick:()=>{l(!0),h("")},sx:{padding:0,":hover div":{paddingRight:3,transition:"padding-right 0.25s"}}},P.createElement(ze,{sx:{fontSize:"48px",marginRight:1,marginLeft:1}}),P.createElement(Pt,{component:"div",sx:{letterSpacing:"-0.05em",bgcolor:"warning.main",padding:1,color:"warning.contrastText",fontSize:"48px",lineHeight:1,transition:"padding-right 0.25s"}},"Import Car")),P.createElement(kt,{disableElevation:!0,size:"large",onClick:()=>{if(e.length>0){let b=e[0].car;u(b.exportCar()),M(!0)}},sx:{padding:0,":hover div":{paddingRight:3,transition:"padding-right 0.25s"}}},P.createElement(Je,{sx:{fontSize:"48px",marginRight:1,marginLeft:1}}),P.createElement(Pt,{sx:{letterSpacing:"-0.05em",bgcolor:"error.main",padding:1,color:"error.contrastText",fontSize:"48px",lineHeight:1,transition:"padding-right 0.25s"}},"Export Best")),P.createElement(kt,{disableElevation:!0,size:"large",onClick:()=>{m(Yt[(Yt.indexOf(t)+1)%Yt.length])},sx:{padding:0,":hover div":{paddingRight:3,transition:"padding-right 0.25s"}}},P.createElement(Ue,{sx:{fontSize:"48px",marginRight:1,marginLeft:1}}),P.createElement(Pt,{sx:{letterSpacing:"-0.05em",bgcolor:"success.main",padding:1,color:"success.contrastText",fontSize:"48px",lineHeight:1,transition:"padding-right 0.25s"}},"Switch Terrain")))))))},pr=qe({palette:{primary:{main:"#312D32",contrastText:"#EAE8E5"},warning:{main:"#D6BC5C",contrastText:"#EAE8E5"},error:{main:"#DD424E",contrastText:"#EAE8E5"},success:{main:"#8B9B56",contrastText:"#EAE8E5"},divider:"#44372f"},typography:{button:{textTransform:"capitalize"}},shape:{borderRadius:0}});Ye.exports.render(P.createElement(Ke,{theme:pr},P.createElement(Mr,null)),document.getElementById("root"));
